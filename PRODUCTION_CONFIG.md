# Zyra AI - Production Configuration Guide

**Last Updated:** October 24, 2025  
**Status:** Almost Ready - 5 secrets need to be added before deployment (see Pending section below)

---

## ‚úÖ Configured Secrets (Already Added)

The following secrets are already configured in Replit Secrets:

### Core Security
- ‚úÖ `ENCRYPTION_KEY` - AES-256-GCM encryption for sensitive data
- ‚úÖ `INTERNAL_SERVICE_TOKEN` - Internal service authentication
- ‚úÖ `SESSION_SECRET` - (Auto-generated by express-session if not set)

### Authentication & Database
- ‚úÖ `SUPABASE_URL` - https://uqahonxcssfxrlmynrjo.supabase.co
- ‚úÖ `SUPABASE_ANON_KEY` - Client-side authentication
- ‚úÖ `SUPABASE_SERVICE_ROLE_KEY` - Server-side admin access

### Payment Gateways
- ‚úÖ `PAYPAL_CLIENT_ID` - PayPal payments (USD only, all countries)
- ‚úÖ `PAYPAL_CLIENT_SECRET` - PayPal API secret

### AI Services
- ‚úÖ `OPENAI_API_KEY` - GPT-4o mini for AI features

### Email & SMS Marketing
- ‚úÖ `SENDGRID_API_KEY` - Transactional emails and campaigns
- ‚úÖ `TWILIO_ACCOUNT_SID` - SMS campaigns
- ‚úÖ `TWILIO_AUTH_TOKEN` - Twilio authentication
- ‚úÖ `TWILIO_PHONE_NUMBER` - SMS sender number

### Performance (Optional but Recommended)
- ‚úÖ `UPSTASH_REDIS_REST_URL` - Redis caching for AI responses
- ‚úÖ `UPSTASH_REDIS_REST_TOKEN` - Redis authentication

---

## üö® REQUIRED: Add These Secrets to Replit

### CORS & Production Domains
These **MUST** be added to Replit Secrets for production deployment:

```bash
PRODUCTION_DOMAIN=https://zzyraai.com
REPLIT_DOMAIN=https://e27e6f72-6959-4e40-b028-11b38051e867-00-3ofd3wmcf6mca.spock.replit.dev
```

**How to add:**
1. Go to Replit Secrets (Tools ‚Üí Secrets)
2. Add each key-value pair exactly as shown above
3. Remove trailing slashes from URLs

### Frontend Environment Variables (VITE_*)
Add these to Replit Secrets for the frontend build:

```bash
VITE_SUPABASE_URL=https://uqahonxcssfxrlmynrjo.supabase.co
VITE_SUPABASE_ANON_KEY=<same value as SUPABASE_ANON_KEY>
```

**Note:** Copy the exact value from `SUPABASE_ANON_KEY` secret into `VITE_SUPABASE_ANON_KEY`

### PayPal Webhook Configuration
To enable payment webhook verification, you need to get the **PAYPAL_WEBHOOK_ID**:

**Step-by-step setup:**
1. Go to PayPal Developer Dashboard: https://developer.paypal.com/dashboard
2. Click "Apps & Credentials" in the left sidebar
3. Select your app (or create one if you haven't)
4. Click the "Webhooks" tab
5. Click "Add Webhook"
6. Enter your webhook URL:
   - **Development:** `https://e27e6f72-6959-4e40-b028-11b38051e867-00-3ofd3wmcf6mca.spock.replit.dev/api/webhooks/paypal`
   - **Production:** `https://zzyraai.com/api/webhooks/paypal`
7. Select event types to subscribe to:
   - `PAYMENT.CAPTURE.COMPLETED` (required)
   - `PAYMENT.CAPTURE.DENIED` (required)
   - `PAYMENT.CAPTURE.REFUNDED` (optional)
8. Click "Save"
9. Copy the "Webhook ID" shown (format: `WH-XXXXX...`)
10. Add to Replit Secrets as `PAYPAL_WEBHOOK_ID=WH-XXXXX...`

**Important:** Without this webhook ID, payment verification will fail and subscriptions won't be activated automatically.

---

## üìä Production Environment Checklist

### ‚úÖ Completed
- [x] All payment processing configured for USD only
- [x] PayPal checkout displays "Zyra AI" branding
- [x] Supabase authentication working (email/password)
- [x] AI response caching enabled (Redis)
- [x] Email campaigns (SendGrid) configured
- [x] SMS campaigns (Twilio) configured
- [x] Security secrets generated and added
- [x] Rate limiting enabled on all endpoints
- [x] CORS security headers configured
- [x] Webhook HMAC verification enabled

### üîÑ Pending (Add to Secrets Before Deployment)
- [ ] `PRODUCTION_DOMAIN=https://zzyraai.com` - Your production website URL
- [ ] `REPLIT_DOMAIN=https://e27e6f72-6959-4e40-b028-11b38051e867-00-3ofd3wmcf6mca.spock.replit.dev` - Your Replit deployment URL
- [ ] `VITE_SUPABASE_URL=https://uqahonxcssfxrlmynrjo.supabase.co` - Frontend Supabase URL
- [ ] `VITE_SUPABASE_ANON_KEY=<copy exact value from SUPABASE_ANON_KEY>` - Frontend Supabase key
- [ ] `PAYPAL_WEBHOOK_ID=WH-XXXXX...` - PayPal webhook verification ID (see PayPal Webhook Configuration section above for setup steps)

### üéØ Pre-Deployment Testing
After adding the above secrets:
- [ ] Test user signup/login flow
- [ ] Test PayPal subscription payment (Starter plan)
- [ ] Verify AI product optimization generates content
- [ ] Test email campaign creation and sending
- [ ] Test abandoned cart recovery
- [ ] Verify analytics dashboard loads correctly
- [ ] Check CORS allows requests from production domain

---

## üöÄ Deployment Commands

### Development (Current)
```bash
npm run dev
```

### Production Build
```bash
# Build frontend and backend
npm run build:all

# Start production server
npm start
```

### Deploy to Replit VM
```bash
# Replit automatically builds and deploys when you click "Deploy"
# Build command: npm run build:all
# Run command: npm start
```

---

## üîí Security Notes

### CORS Configuration
The application uses **exact domain matching** for CORS security:
- ‚úÖ Only allows requests from `PRODUCTION_DOMAIN` and `REPLIT_DOMAIN`
- ‚ùå No wildcard patterns (prevents CSRF attacks)
- ‚úÖ Credentials enabled for authenticated requests

### Important Security Rules
1. **Never commit secrets to Git** - Use Replit Secrets only
2. **Use HTTPS in production** - All domains must use `https://`
3. **No trailing slashes** - URLs should be: `https://zzyraai.com` (not `https://zzyraai.com/`)
4. **Exact URLs only** - No regex patterns in CORS configuration

---

## üìà Performance Optimizations Enabled

- ‚úÖ **Compression:** Gzip/Brotli (70% size reduction)
- ‚úÖ **Static Asset Caching:** 1-year immutable cache
- ‚úÖ **AI Response Caching:** 24-hour Redis TTL (60-80% cost savings)
- ‚úÖ **Campaign Stats Caching:** 5-minute Redis TTL
- ‚úÖ **Database Connection Pooling:** Optimized for production
- ‚úÖ **Code Splitting:** React chunks loaded on demand

---

## üéØ Next Steps

1. **Add Required Secrets** (see "REQUIRED" section above)
2. **Build Production Bundle:** `npm run build:all`
3. **Test Critical Features:** User auth, payments, AI, campaigns
4. **Deploy to Replit VM:** Click "Deploy" button in Replit
5. **Monitor Logs:** Check for errors after deployment
6. **Update DNS:** Point `zzyraai.com` to Replit deployment URL

---

## üí∞ Monthly Costs Estimate

| Service | Cost |
|---------|------|
| Replit Hacker Plan | $7/month |
| Supabase Pro | $25/month |
| OpenAI API (GPT-4o mini) | ~$30-50/month |
| Upstash Redis | $0-10/month |
| SendGrid (Email) | $0-15/month |
| Twilio (SMS) | Pay per use |
| PayPal (Payment Processing) | 2.9% + $0.30 per transaction |
| **Total** | **~$67-107/month** |

---

## üìû Support

For deployment issues:
- Replit Support: https://replit.com/support
- Supabase Support: https://supabase.com/support
- PayPal Developer: https://developer.paypal.com/support

**Document Version:** 1.0
